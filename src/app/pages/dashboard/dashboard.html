<!-- Navegação Principal -->
<header class="main-header">
  <div class="header-container">
    <div class="logo">DinMonex</div>
    <nav>
      <button class="logout-btn" (click)="logout()">Sair</button>
    </nav>
  </div>
</header>

<!-- Conteúdo Principal -->
<main class="dashboard-container">
  <div class="dashboard-header">
    <h1>Minhas Transações</h1>
    <button class="add-btn" (click)="openAddModal()">+ Adicionar Transação</button>
  </div>

  <!-- Estados de Carregamento, Erro e Lista Vazia -->
  <div *ngIf="isLoading" class="loading-indicator">
    <p>A carregar transações...</p>
  </div>
  <div *ngIf="error" class="error-message">
    <p>{{ error }}</p>
  </div>
  <div *ngIf="!isLoading && !error && transactions.length === 0" class="no-transactions">
    <p>Nenhuma transação encontrada.</p>
    <p>Clique em "Adicionar Transação" para começar.</p>
  </div>

  <!-- Lista de Transações (com a nova lógica para o botão) -->
  <div *ngIf="!isLoading && !error && transactions.length > 0" class="transactions-list">
    <div *ngFor="let transaction of transactions" class="transaction-item">
      <div class="transaction-info">
        <div class="transaction-details">
          <span class="transaction-description">{{ transaction.description }}</span>
          
          <!-- Se for Conta de Consumo -->
          <div *ngIf="transaction.type === 'CONSUMPTION'" class="transaction-meta">
            <span>Vencimento: {{ transaction.dueDate | date: 'dd/MM/yyyy' }}</span>
            <span *ngIf="transaction.isRecurring" class="badge recurring">Recorrente</span>
          </div>

          <!-- Se for Cartão de Crédito -->
          <div *ngIf="transaction.type === 'CREDIT_CARD'" class="transaction-meta">
            <span>Compra em {{ transaction.totalInstallments }}x</span>
            <!-- Liga o botão ao novo método, a passar o objeto de transação completo -->
            <button class="view-installments-btn" (click)="openInstallmentModal(transaction)">Ver Parcelas</button>
          </div>
        </div>
        
        <div class="transaction-value">
          <span>{{ transaction.value | currency: 'BRL' }}</span>
        </div>
      </div>

      <div class="transaction-actions">
        <!-- O botão Editar só funciona para Contas de Consumo por agora -->
        <button class="action-btn edit-btn" (click)="openEditModal(transaction.id)" *ngIf="transaction.type === 'CONSUMPTION'">Editar</button>
        <button class="action-btn delete-btn" (click)="deleteTransaction(transaction.id)">Apagar</button>
      </div>
    </div>
  </div>
</main>

<!-- Modal do Formulário -->
<app-transaction-form 
  *ngIf="isTransactionModalVisible"
  [transactionId]="selectedTransactionId"
  (closeModal)="onCloseTransactionModal()"
  (formSaved)="onFormSaved()">
</app-transaction-form>

<!-- Modal da Lista de Parcelas -->
<app-installment-list
  *ngIf="isInstallmentModalVisible"
  [installments]="selectedTransactionInstallments"
  (closeModal)="onCloseInstallmentModal()">
</app-installment-list>

